<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title></title>
    <script type="text/javascript" src="http://code.jquery.com/jquery-1.10.1.js"></script>
    <script type="text/javascript" src="http://code.highcharts.com/highcharts.js"></script>
    <script>
      var chart; // global

      function requestData() {
        $.ajax({
          url: 'http://localhost:3000/',
          success: function(point) {
            let dt = point['created_at'];
            let year = dt[0];
            let month = dt[1]-1;
            let day = dt[2];
            let hour = dt[3];
            let minute = dt[4];
            let second = dt[5];
            let datetime = Date.UTC(year,month,day,hour,minute,second);
            console.log(new Date(datetime));
            var series = chart.series[0],
            shift = series.data.length > 20; // shift if the series is longer than 20
            chart.series[0].addPoint([datetime,point["value"]], true, shift);
            setTimeout(requestData, 5000);
          },
          cache: false
        });
      }

     function nowInTimezoneOffset(offset) {
      var d = new Date();
      var utc = d.getTime() - (d.getTimezoneOffset() * 60000);
      var nd = new Date(utc + (3600000*offset)).getTime();
      return nd;
    } 

      $(document).ready(function() {
        Highcharts.setOptions({
          global: {
            timezoneOffset: 15*60 //this is a workaround for the bug. Parameter should be (-9*60).
          }
        });
        chart = new Highcharts.Chart({
          chart: {
            renderTo: 'container',
            defaultSeriesType: 'spline',
            events: {
              load: requestData
            }
          },
          title: {
            text: 'Temperature data'
          },
          xAxis: {
            type: 'datetime',
          },
          yAxis: {
            title: {
              text: 'Temperature',
              margin: 80
            }
          },
          series: [{
            name: 'Temperature',
            pointStart: nowInTimezoneOffset(-9.0),
            data: [1]
          }]
        });
      });
    </script>

  </head>
  <body>
    <div id="container" style="width: 800px; height: 400px; margin: 0 auto"></div>

  </body>
</html>
